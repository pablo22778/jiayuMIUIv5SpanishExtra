#!/system/bin/sh

#Nos entropy Generator engine for Fly-On Mod™ by Slaid480
#Copyright (C) 2013 Jeffrey Gomez (Exit_Only)

#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#  GNU General Public License for more details.

#  You should have received a copy of the GNU General Public License along with this program.  If not, see <http://www.gnu.org/licenses/>.

#===============================================================#

clear
   echo ""
   echo "==========================================="
   echo "==       ENTROPY GENERATOR SWITCH        =="
   echo "==       For Fly-On Mod™ by Slaid480     =="
   echo "==       Thanks to Exit_Only @ XDA 2013  =="
   echo "==========================================="
sleep 1
   echo ""
   echo "Turning Entropy generator switch off..."
sleep 1
busybox mount -o rw,remount /system
busybox rm -f /data/Fly-On/S08_rngd.log
busybox touch /data/Fly-On/S08_rngd.log
   echo ""
   echo "Checking for qrngd binary [ Qualcomm devices ONLY ] ..."
sleep 1
if [ -e /system/etc/entropy/qrngd_bin ]; then
   echo ""
   echo "Restoring qrngd binary [ Qualcomm devices ONLY ] ..."
sleep 1
cp /system/etc/entropy/qrngd_bin /system/bin/qrngd
busybox rm -f /system/etc/entropy/qrngd_bin
busybox chmod -f 777 /system/bin/qrngd
busybox chown -f 0.0 /system/bin/qrngd
fi
if [ -e /system/etc/entropy/qrngd_xbin ]; then
   echo ""
   echo "Restoring qrngd binary [ Qualcomm devices ONLY ] ..."
sleep 1
cp /system/etc/entropy/qrngd_xbin /system/xbin/qrngd
busybox rm -f /system/etc/entropy/qrngd_xbin
busybox chmod -f 777 /system/xbin/qrngd
busybox chown -f 0.0 /system/xbin/qrngd
fi
STATE=/data/Fly-On/rngd_state
busybox rm -f $STATE
busybox touch $STATE
echo "# Fly-On" >> $STATE
echo "" >> $STATE
echo "Rngd binary: 'OFF'" >> $STATE
echo "" >> $STATE
echo "Rngd binary state: 'INACTIVE' " >> $STATE
echo "" >> $STATE
echo "Rngd binary governor: 'INACTIVE' " >> $STATE
busybox rm -f /data/rngd.pid
busybox rm -f /system/etc/init.d/S08_rngd
busybox rm -f /system/bin/entro
busybox rm -f /system/bin/rngd
   echo ""
   echo "Rngd binary is now de-activated..."
sleep 1
   echo ""
   echo "This switch WILL survive a full reboot..."
sleep 1
   echo ""
   echo "You MUST turn the switch on in order to de-activate the rngd binary..."
sleep 1
   echo ""
   echo "Type 'su' then type 'rngd_on' to re-activate rngd binary..."
sleep 2
   echo ""
   echo "Do you want to 'Hard Reboot' or 'Soft Reboot?"
sleep 1
   echo ""
   echo -n "Please select an option: [ Hard Reboot = 1 | Soft Reboot = 2 ]: "
read option2
if [ $option2 -ne 1 ]; then
killall -9 system_server
else
reboot
busybox reboot
fi